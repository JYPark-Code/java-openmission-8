<html layout:decorate="~{layout}"
      xmlns:layout="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.w3.org/1999/xhtml">

<div layout:fragment="content" class="container my-3">

    <!-- 1. 프로필 카드 -->
    <h3 class="mb-4">마이 페이지</h3>

    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title" th:text="${user.username} + ' 님'">사용자 이름</h5>
            <p class="card-text mb-1">
                <strong>이메일:</strong>
                <span th:text="${user.email}">email@example.com</span>
            </p>
            <p class="card-text mb-1">
                <strong>가입일:</strong>
                <span th:text="${#temporals.format(user.createDate, 'yyyy-MM-dd HH:mm')}">
                    2025-11-19 12:34
                </span>
            </p>
            <p class="card-text">
                <strong>가입 후 경과일:</strong>
                <span th:text="${daysSinceJoin}"></span>일째
            </p>
            <p class="card-text">
                <strong>자기소개:</strong>
                <span th:text="${user.bio} ?: '아직 자기소개가 없습니다.'"></span>
            </p>
        </div>
    </div>

    <!-- 2. 활동 요약 -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header">내 활동 요약</div>
                <div class="card-body">
                    <p>작성한 질문: <strong th:text="${summary.questionCount}">0</strong>개</p>
                    <p>작성한 답변: <strong th:text="${summary.answerCount}">0</strong>개</p>
                    <p>작성한 댓글: <strong th:text="${summary.commentCount}">0</strong>개</p>
                </div>
            </div>
        </div>
        <div class="col-md-6 mt-3 mt-md-0">
            <div class="card h-100">
                <div class="card-header">추천 활동</div>
                <div class="card-body">
                    <p>추천한 질문: <strong th:text="${summary.votedQuestionCount}">0</strong>개</p>
                    <p>추천한 답변: <strong th:text="${summary.votedAnswerCount}">0</strong>개</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. 최근 활동 (질문 / 답변 / 댓글) -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-header">최근 작성한 질문</div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"
                        th:each="q : ${recentQuestions}">
                        <a th:href="@{|/question/detail/${q.id}|}"
                           th:text="${q.subject}">제목</a>
                        <br>
                        <small th:text="${#temporals.format(q.createDate, 'yyyy-MM-dd HH:mm')}">
                            2025-11-19
                        </small>
                    </li>
                    <li class="list-group-item text-muted"
                        th:if="${#lists.isEmpty(recentQuestions)}">
                        아직 작성한 질문이 없습니다.
                    </li>
                </ul>
            </div>
        </div>

        <div class="col-md-4 mt-3 mt-md-0">
            <div class="card h-100">
                <div class="card-header">최근 작성한 답변</div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"
                        th:each="a : ${recentAnswers}">
                        <a th:href="@{|/question/detail/${a.question.id}|}">
                            질문: <span th:text="${a.question.subject}">제목</span>
                        </a>
                        <br>
                        <small th:text="${#temporals.format(a.createDate, 'yyyy-MM-dd HH:mm')}"></small>
                    </li>
                    <li class="list-group-item text-muted"
                        th:if="${#lists.isEmpty(recentAnswers)}">
                        아직 작성한 답변이 없습니다.
                    </li>
                </ul>
            </div>
        </div>

        <div class="col-md-4 mt-3 mt-md-0">
            <div class="card h-100">
                <div class="card-header">최근 작성한 댓글</div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"
                        th:each="c : ${recentComments}">
                        <a th:href="@{|/question/detail/${c.answer.question.id}?openCommentFor=${c.answer.id}#comment-${c.id}|}">
                        <span th:text="${#strings.abbreviate(c.content, 30)}">댓글 내용</span>
                        </a>
                        <br>
                        <small th:text="${#temporals.format(c.createDate, 'yyyy-MM-dd HH:mm')}"></small>
                    </li>
                    <li class="list-group-item text-muted"
                        th:if="${#lists.isEmpty(recentComments)}">
                        아직 작성한 댓글이 없습니다.
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- 4. 프로필 편집 폼 -->
    <div class="card mb-4">
        <div class="card-header">프로필 편집</div>
        <div class="card-body">
            <form th:action="@{/user/profile}" method="post">
                <input type="hidden"
                       th:name="${_csrf.parameterName}"
                       th:value="${_csrf.token}" />

                <div class="mb-3">
                    <label for="email" class="form-label">이메일</label>
                    <input id="email"
                           name="email"
                           type="email"
                           class="form-control"
                           th:value="${user.email}">
                </div>

                <div class="mb-3">
                    <label for="bio" class="form-label">자기소개</label>
                    <textarea id="bio"
                              name="bio"
                              class="form-control"
                              rows="3"
                              th:text="${user.bio}"></textarea>
                </div>

                <button type="submit" class="btn btn-primary">프로필 저장</button>
            </form>
        </div>
    </div>

    <!-- 5. 비밀번호 변경 폼 (일단 UI만) -->
    <div class="card mb-4">
        <div class="card-header">비밀번호 변경</div>
        <div class="card-body">

            <div th:if="${passwordChangeMessage}" class="alert alert-info"
                 th:text="${passwordChangeMessage}">
                비밀번호 변경 메시지
            </div>

            <form th:action="@{/user/password}" method="post">
                <input type="hidden"
                       th:name="${_csrf.parameterName}"
                       th:value="${_csrf.token}" />


                <div class="mb-3">
                    <label for="newPassword" class="form-label">새 비밀번호</label>
                    <input id="newPassword"
                           name="newPassword"
                           type="password"
                           class="form-control">
                </div>

                <div class="mb-3">
                    <label for="newPasswordConfirm" class="form-label">새 비밀번호 확인</label>
                    <input id="newPasswordConfirm"
                           name="newPasswordConfirm"
                           type="password"
                           class="form-control">
                </div>

                <button type="submit" class="btn btn-primary">
                    비밀번호 변경
                </button>
            </form>
        </div>
    </div>

</div>
</html>
